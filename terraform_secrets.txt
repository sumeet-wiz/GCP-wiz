# secrets.tf - Secret Manager and Security Services with Misconfigurations

# Secret Manager secrets with various misconfigurations
resource "google_secret_manager_secret" "database_credentials" {
  project   = var.project_id
  secret_id = "csmp-test-database-credentials"

  # MISCONFIGURATION: Automatic replication (no geographic restrictions)
  replication {
    automatic = true
  }
  
  # MISCONFIGURATION: No expiration policy
  # MISCONFIGURATION: No rotation policy
  
  labels = {
    environment = "test"
    type = "database-credentials"
    sensitivity = "high"
  }
}

resource "google_secret_manager_secret_version" "database_credentials_v1" {
  secret = google_secret_manager_secret.database_credentials.id
  
  # MISCONFIGURATION: Weak credentials stored
  secret_data = jsonencode({
    username = "admin"
    password = "admin123"
    host = "db.example.com"
    port = 3306
    database = "production_db"
    ssl_mode = "disable"  # MISCONFIGURATION: SSL disabled
  })
}

# SEVERE MISCONFIGURATION: Public access to database credentials
resource "google_secret_manager_secret_iam_member